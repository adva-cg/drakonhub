function Main2(window, document, translate, contentPath) {


var DarkBackground = "#455A64"

var LineHeight = 34
var MobileWidth = 700
var BigWidth = 1000
var LogonWidth = 300

var globs = {}
var SignUpFirst = false

globs.resizer = null

var logonCtrl = new Logon(window, document, translate)


// Autogenerated with DRAKON Editor 1.33


function acceptCookies() {
    display("cookie_warning", "none")
    HtmlUtils.setCookie(
        "cookies_accepted",
        "true",
        30
    )
}

function activateBasic() {
    console.log("activateBasic")
}

function addPopupItem(div, item) {
    if (item.type == "separator") {
        var hr = make(div, "hr")
        hr.style.margin = "0px"
    } else {
        var callback = function(evt) {
        	hidePopup()
        	item.code(evt)
        }
        var row = make(div, "div")
        row.className = "list_item"
        row.style.height = LineHeight + "px"
        var textPart = makeIB(row)
        textPart.style.padding = "8px"
        HtmlUtils.setDivText(
        	textPart,
        	translate(item.text)
        )
        var itemId = item.id || ""
        row.onclick = callback
    }
}

function agreeChanged(agree) {
    if (agree) {
        display("create_account", "block")
        display("create_account_grey", "none")
    } else {
        display("create_account", "none")
        display("create_account_grey", "block")
    }
}

function createPopupList(items) {
    var div = HtmlUtils.createPopup()
    div.className = "popup"
    div.style.background = "white"
    var _ind112 = 0;
    var _col112 = items;
    var _len112 = _col112.length;
    while (true) {
        if (_ind112 < _len112) {
            
        } else {
            break;
        }
        var item = _col112[_ind112];
        addPopupItem(div, item)
        _ind112++;
    }
    return div
}

function disablePurchaseButton(id) {
    var active, nothing, purchase, trial
    trial = document.getElementById("start_trial")
    purchase = document.getElementById("purchase")
    active = document.getElementById(id)
    nothing = function() {}
    trial.onclick = nothing
    purchase.onclick = nothing
    HtmlUtils.setText(id, translate("MES_WORKING"))
}

function disableSignupOk() {
    display("create_account", "none")
    display("create_account_grey", "none")
}

function display(id, value) {
    var div
    div = document.getElementById(id)
    if (div) {
        div.style.display = value
    }
}

function displayMany(className, value) {
    var divs
    divs = document.getElementsByClassName(className)
    var _ind409 = 0;
    var _col409 = divs;
    var _len409 = _col409.length;
    while (true) {
        if (_ind409 < _len409) {
            
        } else {
            break;
        }
        var div = _col409[_ind409];
        div.style.display = value
        _ind409++;
    }
}

function enableSignupOk() {
    display("create_account", "block")
    display("create_account_grey", "none")
}

function get(id) {
    var element = document.getElementById(id)
    if (element) {
        return element
    } else {
        throw Error("Element '" + id + "' not found")
    }
}

function getLanguageNeutral() {
    var languages, part, path, path2, result
    path = window.location.pathname
    languages = ["en", "ru"]
    var _ind56 = 0;
    var _col56 = languages;
    var _len56 = _col56.length;
    while (true) {
        if (_ind56 < _len56) {
            
        } else {
            path2 = path
            break;
        }
        var language = _col56[_ind56];
        part = "/" + language
        if (Utils.startsWith(path, part)) {
            result = path.substring(part.length)
            if (result) {
                path2 = result
            } else {
                path2 = "/"
            }
            break;
        }
        _ind56++;
    }
    return path2 + window.location.search
}

function getLanguagePopupItems() {
    var english, items, russian
    english = {
        text : "English",
        code : switchToEnglish
    }
    russian = {
        text : "Russian",
        code : switchToRussian
    }
    items = [english, russian]
    return items
}

function getQueryParameter(name) {
    var search
    search = Utils.parseSearch(
        window.location.search
    )
    return search[name]
}

function getRef() {
    return getQueryParameter("ref")
}

function getUserPopupItems() {
    var goToUserAccount, items, logoutItem, user
    goToUserAccount = function() {
        goTo("/account")
    }
    user = {
        text : "MES_USER_ACCOUNT",
        code : goToUserAccount
    }
    logoutItem = {
        text : "Logout",
        code : logout
    }
    items = [user, logoutItem]
    return items
}

function goTo(url) {
    window.location.href = url
}

function goToDashboard() {
    goTo("/ide/dashboard")
}

function hideMobileMenu() {
    display("mob_menu", "none")
    display("ui", "block")
    document.body.className = "red_back"
}

function hidePopup() {
    HtmlUtils.hidePopup()
}

function init() {
    initCookies()
    registerClick("languages", showLanguagesPopup)
    registerClick("languages_mob", showLanguagesPopup)
    registerClick("mob_menu_butt", showMobileMenu)
    registerClick("close_mob_menu_butt", hideMobileMenu)
    registerEvent("account", "onclick", showUserPopup)
    if ((gUserId) || (!(document.getElementById("i_agree")))) {
        
    } else {
        globs.signupCtrl = new Signup(
            window,
            document,
            translate,
            "userName",
            "email",
            "pass",
            "pass2",
            "signup_message",
            disableSignupOk,
            onSignupOk,
            enableSignupOk,
            false
        )
    }
    if (gUserId) {
        displayMany("no_user", "none")
        displayMany("yes_user", "block")
    } else {
        displayMany("no_user", "block")
        displayMany("yes_user", "none")
    }
    if (gOnPremises) {
        
    } else {
        displayMany("agree", "block")
    }
}

function initCookies() {
    var divs, nothing, ref
    HtmlUtils.setCookie("language", gLanguage)
    if ((gUserId) || (userAcceptedCookies())) {
        
    } else {
        display("cookie_warning", "block")
    }
    if ((gUserId) || (!(SignUpFirst))) {
        
    } else {
        divs = document.getElementsByClassName(
            "must_be_logged_in"
        )
        var _ind508 = 0;
        var _col508 = divs;
        var _len508 = _col508.length;
        while (true) {
            if (_ind508 < _len508) {
                
            } else {
                break;
            }
            var div = _col508[_ind508];
            div.href = "/signup?tgt=" + div.href
            _ind508++;
        }
    }
    ref = getRef()
    if (ref) {
        nothing = function() {}
        HtmlUtils.sendPost(
            "/api/set_ref",
            {ref: ref},
            nothing,
            nothing
        )
    }
}

function initTrial() {
    display("plan", "block")
}

function logon() {
    logonCtrl.logon(
        "userNameLogin",
        "passLogin",
        "logon_message",
        onLogonCompleted
    )
}

function logout() {
    logonCtrl.logout()
}

function make(parent, tag) {
    var element = document.createElement(tag)
    parent.appendChild(element)
    //element.ontouchstart = prevent
    //element.ontouchmove = prevent
    //element.ontouchend = prevent
    return element
}

function makeIB(parent) {
    var div = make(parent, "div")
    div.style.display = "inline-block"
    return div
}

function makeSeparator(list) {
    var item = {
    	type: "separator"
    }
    list.push(item)
}

function makeTextListItem(list, textId, action, id, image) {
    var item = {
    	text: translate(textId),
    	code: action,
    	id: id,
    	image: image
    }
    list.push(item)
}

function onLoginPassDown(evt) {
    var _sw2460000_ = 0;
    _sw2460000_ = evt.keyCode;
    if (_sw2460000_ === 13) {
        logon()
    }
}

function onLoginUserDown(evt) {
    var _sw2310000_ = 0;
    _sw2310000_ = evt.keyCode;
    if (_sw2310000_ === 13) {
        get("passLogin").focus()
    }
}

function onLogonCompleted() {
    var target
    target = getQueryParameter("tgt")
    if (target) {
        goTo(target)
    } else {
        goToDashboard()
    }
}

function onSignupEmailDown(evt) {
    var _sw2950000_ = 0;
    _sw2950000_ = evt.keyCode;
    if (_sw2950000_ === 13) {
        signup()
    }
}

function onSignupOk() {
    var target, url
    target = getQueryParameter("tgt")
    if (target) {
        goTo(target)
    } else {
        url = "/welcome"
        if (globs.next) {
            url += "?next=" + globs.next
        }
        goTo(url)
    }
}

function onSignupUserDown(evt) {
    var _sw2830000_ = 0;
    _sw2830000_ = evt.keyCode;
    if (_sw2830000_ === 13) {
        get("email_edit").focus()
    }
}

function purchase() {
    var product, ref, url
    disablePurchaseButton("purchase")
    product = getQueryParameter("product") || "extended"
    ref = getQueryParameter("ref") || "trial"
    url = "/buy?product=" + product +
    	"&ref=" + ref
    goTo(url)
}

function putExamples(targetId, examples) {
    var a, img, size, target
    size = 160
    target = get(targetId)
    var _ind393 = 0;
    var _col393 = examples;
    var _len393 = _col393.length;
    while (true) {
        if (_ind393 < _len393) {
            
        } else {
            break;
        }
        var example = _col393[_ind393];
        a = make(target, "a")
        a.className = "example_item"
        img = make(a, "img")
        img.width = size
        img.height = size
        img.src = "/static/" + example.image
        img.style.verticalAlign = "bottom"
        if (gUserId) {
            a.href = example.ex
        } else {
            a.href = example.url
        }
        _ind393++;
    }
}

function registerClick(id, callback) {
    var div
    div = document.getElementById(id)
    if (div) {
        div.onclick = callback
    }
}

function registerEvent(id, event, callback) {
    var div
    div = document.getElementById(id)
    if (div) {
        div[event] = callback
    }
}

function reloadPage() {
    var url
    url = getLanguageNeutral()
    window.location.href = url
}

function setLanguage(lang) {
    var data, noop, reload
    HtmlUtils.setCookie("language", lang)
    noop = function() {}
    reload = reloadPage
    if (gUserId) {
        data = {
            language : lang
        }
        HtmlUtils.sendPost(
            "/api/theme",
            data,
            reload,
            noop
        )
    } else {
        reload()
    }
}

function showLanguagesPopup(evt) {
    var div, items
    div = evt.target
    items = getLanguagePopupItems()
    showPopupList(div, items)
}

function showMobileMenu() {
    display("ui", "none")
    display("mob_menu", "block")
    document.body.className = "white_back"
}

function showPopupList(parentDiv, items) {
    var div = createPopupList(items)
    HtmlUtils.showUnder(parentDiv, div)
}

function showUserPopup(evt) {
    var div, items
    div = evt.target
    items = getUserPopupItems()
    showPopupList(div, items)
}

function signup(next) {
    var product
    if (Config.dead) {
        window.location.href = "/static/dead.html"
    }
    if ((gOnPremises) || (get("i_agree").checked)) {
        globs.next = next
        product = getQueryParameter("product")
        globs.signupCtrl.signup(
            contentPath || "main",
            product
        )
    } else {
        HtmlUtils.setText(
        	"signup_message",
        	translate("MES_AGREE")
        )
    }
}

function switchToEnglish() {
    setLanguage('en-us')
}

function switchToRussian() {
    setLanguage('ru')
}

function trial() {
    var onError, onSuccess, payload, product
    disablePurchaseButton("start_trial")
    product = getQueryParameter("product") || "extended"
    payload = {
        product : product
    }
    onSuccess = function() {
        goTo("/welcome-trial")
    }
    onError = function() {
        goTo("/")
    }
    HtmlUtils.sendPost(
        "/api/trial",
        payload,
        onSuccess,
        onError
    )
}

function userAcceptedCookies() {
    if (HtmlUtils.getCookie("cookies_accepted")) {
        return true
    } else {
        return false
    }
}


this.init = init
this.onLoginUserDown = onLoginUserDown
this.onLoginPassDown = onLoginPassDown
this.logon = logon
this.logout = logout
this.signup = signup
this.onSignupUserDown = onSignupUserDown
this.onSignupEmailDown = onSignupEmailDown
this.agreeChanged = agreeChanged
this.acceptCookies = acceptCookies
this.getRef = getRef
this.putExamples = putExamples
this.trial = trial
this.purchase = purchase
this.initTrial = initTrial
this.activateBasic = activateBasic
this.getQueryParameter = getQueryParameter
}
